<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ZoeWonTecTool</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    #info {
      margin-top: 20px;
    }
    img {
      max-width: 100%;
      height: auto;
      margin-top: 20px;
    }
    canvas {
      display: none;
    }
    #controls {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>图片信息解析与格式转换</h1>
  <input type="file" id="upload" accept="image/*">
  <div id="info">
    <h2>图片信息</h2>
    <p id="fileInfo">请上传图片以查看信息。</p>
    <ul id="details"></ul>
  </div>
  <canvas id="canvas"></canvas>
  <img id="preview" alt="图片预览">

  <div id="controls">
    <h2>图片格式转换</h2>
    <label for="format">选择目标格式：</label>
    <select id="format">
      <option value="image/png">PNG</option>
      <option value="image/jpeg">JPEG</option>
      <option value="image/webp">WebP</option>
    </select>
    <br><br>
    <label for="width">宽度：</label>
    <input type="number" id="width" placeholder="输入宽度">
    <label for="height">高度：</label>
    <input type="number" id="height" placeholder="输入高度">
    <br><br>
    <button id="convert">转换图片</button>
    <a id="download" style="display: none;">下载转换后的图片</a>
  </div>

  <script>
    const upload = document.getElementById('upload');
    const fileInfo = document.getElementById('fileInfo');
    const details = document.getElementById('details');
    const canvas = document.getElementById('canvas');
    const preview = document.getElementById('preview');
    const format = document.getElementById('format');
    const widthInput = document.getElementById('width');
    const heightInput = document.getElementById('height');
    const convertButton = document.getElementById('convert');
    const downloadLink = document.getElementById('download');

    let img = new Image();

    upload.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (file) {
        // 显示文件基本信息
        fileInfo.textContent = `文件名: ${file.name}, 大小: ${(file.size / 1024).toFixed(2)} KB, 类型: ${file.type}`;

        // 读取图片并显示预览
        const reader = new FileReader();
        reader.onload = (e) => {
          preview.src = e.target.result;

          // 加载图片到 Canvas 以解析更多信息
          img.src = e.target.result;
          img.onload = () => {
            const ctx = canvas.getContext('2d');
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);

            // 获取图片分辨率
            const width = img.width;
            const height = img.height;

            // 获取位深度（假设为 24 位或 32 位）
            const bitDepth = ctx.getImageData(0, 0, 1, 1).data.length * 8;

            // 显示详细信息
            details.innerHTML = `
              <li>分辨率: ${width} x ${height}</li>
              <li>文件类型: ${file.type}</li>
              <li>文件大小: ${(file.size / 1024).toFixed(2)} KB</li>
              <li>位深度: ${bitDepth} 位</li>
            `;

            // 设置默认宽高
            widthInput.value = width;
            heightInput.value = height;
          };
        };
        reader.readAsDataURL(file);
      } else {
        fileInfo.textContent = '请上传图片以查看信息。';
        details.innerHTML = '';
        preview.src = '';
      }
    });

    convertButton.addEventListener('click', () => {
      const selectedFormat = format.value;
      const newWidth = parseInt(widthInput.value, 10);
      const newHeight = parseInt(heightInput.value, 10);

      if (isNaN(newWidth) || isNaN(newHeight) || newWidth <= 0 || newHeight <= 0) {
        alert('请输入有效的宽度和高度！');
        return;
      }

      // 调整 Canvas 尺寸并重新绘制图片
      canvas.width = newWidth;
      canvas.height = newHeight;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, newWidth, newHeight);

      // 导出图片为用户选择的格式
      canvas.toBlob((blob) => {
        const url = URL.createObjectURL(blob);
        downloadLink.href = url;
        downloadLink.download = `converted.${selectedFormat.split('/')[1]}`;
        downloadLink.style.display = 'block';
        downloadLink.textContent = '点击下载转换后的图片';
      }, selectedFormat);
    });
  </script>
</body>
</html>
